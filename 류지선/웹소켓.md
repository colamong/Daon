
# WebSocket TIL - 실시간 양방향 통신의 핵심

## 1. 서론

이번 TIL은 **웹 소켓(WebSocket)** 에 대한 학습 내용을 정리한 것입니다.

HTTP 기반 구조에서는 클라이언트가 요청해야만 서버가 응답할 수 있는 **단방향 통신** 구조였고, 실시간 통신이 필요한 경우 여러 비효율적인 우회 방식이 사용되었습니다.

이러한 문제를 해결하기 위해 **WebSocket 프로토콜**이 등장했습니다.

---

## 2. 웹 소켓의 등장 배경

초기의 웹 통신은 모두 **HTTP 기반의 Request-Response 구조**

```text
클라이언트 → (요청) → 서버 → (응답) → 클라이언트
```

이 방식은 간단한 요청-응답 기반의 페이지 조회에는 적합하지만, **서버가 먼저 클라이언트에 메시지를 보낼 수 없기 때문에** 실시간 통신에 큰 제약

이를 보완하기 위해 등장했던 방식들

---

## 2.1. 기존 실시간 통신 방식들

### 2.1.1. Polling (폴링)

- 일정 간격으로 클라이언트가 서버에 **주기적인 요청**을 보냄
- 응답이 없어도 서버는 매번 응답해야 함
- 구현은 간단하지만 **불필요한 요청과 트래픽**이 많음

```javascript
setInterval(() => {
  fetch('/server').then(res => res.text()).then(console.log);
}, 5000);
```

---

### 2.1.2. Long Polling (롱 폴링)

- 요청을 보내면 서버가 **응답을 지연**시키고,
  새로운 데이터가 생기면 그때 응답함
- 요청 횟수는 줄어들지만 여전히 지연이 존재하고 구현이 복잡

```javascript
function longPoll() {
  fetch('/server').then(res => res.text()).then(data => {
    console.log(data);
    longPoll(); // 재귀 호출
  });
}
longPoll();
```

---

### 2.1.3. Server-Sent Events (SSE)

- 서버가 데이터를 push하는 방식 (단방향)
- 브라우저 기본 API인 `EventSource`를 사용
- 자동 재연결 기능도 있지만 **양방향 통신은 불가능**

```javascript
const source = new EventSource('/server');
source.onmessage = event => {
  console.log(event.data);
};
```

---

## 2.2. WebSocket이란?

**WebSocket**은 HTML5에서 등장한 **실시간 양방향 통신을 위한 프로토콜**이다.

- **TCP 기반**의 신뢰성 있는 연결
- 클라이언트 ↔ 서버 간 **지속적인 연결** 유지
- 한 번 연결되면 요청/응답 없이 자유롭게 양쪽 모두 메시지 전송 가능

```javascript
const socket = new WebSocket("ws://example.com/socket");

socket.onopen = () => console.log("Connected");
socket.onmessage = event => console.log("Message:", event.data);
socket.onerror = err => console.error("Error:", err);
socket.onclose = () => console.log("Closed");
```

###  wss:// ?
`wss://`는 보안 연결(WebSocket over TLS)로, HTTPS처럼 암호화된 통신을 지원한다.

---

## 2.3. WebSocket Handshake

WebSocket 연결은 처음에 HTTP 요청으로 시작

**Request 헤더 예:**

```
GET /socket HTTP/1.1
Host: example.com
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
Sec-WebSocket-Version: 13
```

**Response 헤더 예:**

```
HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=
```

이후 연결은 TCP 기반으로 유지되며 실시간 통신이 가능

---

## 2.4. WebSocket 데이터 전송 구조

데이터는 **프레임(Frame)** 단위로 전송되며 종류는 다음과 같다.

| 프레임 유형             | 설명 |
|------------------------|------|
| Text Frame             | 문자열 데이터 전송 |
| Binary Frame           | 이진 데이터 전송 (파일, 이미지 등) |
| Ping / Pong Frame      | 연결 유지 확인 |
| Close Frame            | 연결 종료 요청 |

---

## 3. WebSocket vs 기존 방식 비교

| 항목            | Polling / Long Polling / SSE | WebSocket |
|-----------------|------------------------------|-----------|
| 통신 방향        | 단방향 (클라이언트 → 서버)       | 양방향 |
| 실시간성         | 제한적                          | 우수 |
| 연결 유지        | 매 요청마다 or 연결 유지 필요    | 한 번 연결 후 지속 |
| 서버 푸시        | X (SSE만 가능)                 | 가능 |
| 트래픽 / 비용     | 많음 (불필요한 요청)             | 적음 |
| 확장성 / 스케일링 | 낮음                            | 높음 (설계에 따라 다름) |

---

## 4. WebSocket의 한계점

| 한계점            | 설명 |
|------------------|------|
| **브라우저 호환성** | HTML5 미지원 브라우저에서는 사용 불가 |
| **서버 부하 증가**  | 수많은 소켓 연결 유지 시 리소스 증가 |
| **에러 처리 부족**  | 연결 해제 사유 등 명확한 에러 정보 부족 |
| **재연결 처리 필요** | 자동 재연결 기능 없음 → 직접 구현 필요 |

---

## 5. 예시

| 활용 분야      | 설명 |
|----------------|------|
| **실시간 채팅**  | 양방향 통신의 대표적 예시 |
| **주식/코인 시세** | 수초 단위 실시간 가격 반영 |
| **멀티플레이 게임** | 플레이어 간 빠른 동기화 |
| **협업 툴**    | Google Docs, Miro 등 |
| **알림 시스템**   | 실시간 이벤트 푸시 기능 구현 |

---

## 6. 마무리

WebSocket은 기존 HTTP 구조의 단점을 보완하며 **실시간 양방향 통신을 효율적이고 가볍게 구현할 수 있는 기술**

Polling, Long Polling, SSE는 각각 장단점이 있지만 WebSocket은 그 중 가장 강력한 통신 수단으로 자리잡고 있다.

> 실시간성이 중요한 서비스라면 WebSocket은 선택이 아닌 필수이다.

---
